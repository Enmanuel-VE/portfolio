---
	import type { ProjectType } from '../../data/projects.ts';
	import { projects } from '../../data/projects.ts';
	import ViewToggle from '../atoms/ViewToggle.astro';
	import SectionLayout from '../layouts/SectionLayout.astro';
	import ProjectCard from '../molecules/ProjectCard.astro';

	const cards: ProjectType[] = projects.map((p) => ({ ...p.asObject }));

	const dataSection = {
		title: 'Proyectos',
		description:
			'Una mirada a los proyectos que he creado con dedicación y curiosidad. Cada uno cuenta una historia, resuelve un problema o explora una idea que me entusiasmó construir.',
	} as const;
---
<SectionLayout id="proyectos" ariaLabel="Proyectos">
	<div
		class="relative container mx-auto flex w-full flex-col gap-15 px-4 py-15 md:py-25 lg:max-w-6xl"
	>
		<header class="flex flex-row flex-wrap items-center justify-center gap-4">
			<div class="flex flex-1 flex-col gap-2">
				<h2 class="text-2xl font-bold text-black dark:text-white">
					{dataSection.title}
				</h2>
				<p class="text-sm text-pretty text-black/75 dark:text-white/75">
					{dataSection.description}
				</p>
			</div>

			<ViewToggle/>
		</header>

		<div id="project-cards" class="flex flex-col gap-4">
			{
        cards.map((card) => (
          <ProjectCard
            title={card.title}
            description={card.description}
            image={card.image}
            repository={card.repository}
            demo={card.demo}
            stackTech={card.stackTech}
          />
        ))
      }
		</div>
	</div>

	<script>
		enum StateView {
			ROWS = 'rows',
			GRID = 'grid',
		}

		function viewManager() {
			const cards = document.querySelectorAll('.project-card');
			const btnRows = document.querySelector('#btn-rows-projects');
			const btnGrid = document.querySelector('#btn-grid-projects');
			const buttons = [btnRows, btnGrid];

			let stateView: StateView = StateView.ROWS;

			function updateCardClasses() {
				if (!cards) return;

				cards.forEach((card) => {
					const isGrid = stateView === StateView.GRID;
					card.classList.toggle('card-grid-mode', isGrid);
					card.classList.toggle('card-row-mode', !isGrid);
				});
			}

			function setViewMode(mode: StateView) {
				const earlyReturn = stateView === mode;
				if (earlyReturn) return;

				stateView = mode;
				updateCardClasses();
			}

			buttons.forEach((btn) => {
				if (!btn) return;
				btn.addEventListener('click', () => {
					const isBtnRows = btn.id === 'btn-rows-projects';
					const action = isBtnRows ? StateView.ROWS : StateView.GRID;
					setViewMode(action);
				});
			});

			updateCardClasses();
		}

		viewManager();
	</script>
</SectionLayout>

<style>
	/* ROW MODE */
	.container:has(#btn-rows-projects.btn-active) #project-cards {
		display: grid;
		grid-template-columns: 1fr;
		grid-auto-rows: minmax(15rem, auto);

		gap: 1rem;

		@media (height >= 28rem) {
			grid-auto-rows: minmax(10dvh, 45vh);
		}
	}

	/* GRID MODE */
	.container:has(#btn-grid-projects.btn-active) #project-cards {
		display: grid;
		grid-template-columns: 1fr;
		grid-auto-rows: minmax(15rem, 80vh);

		gap: 1rem;

		@media (width >= 28rem) {
			grid-template-columns: repeat(auto-fit, minmax(15rem, 1fr));
		}
	}
</style>
